# Drone Detector Sim

## Overview

Drone Detector Sim is a ROS 2 package designed to generate high-fidelity synthetic data for training 3D object detectors (specifically PointPillars) to detect UAVs. This simulation addresses the challenge of acquiring large-scale, labeled datasets for drone detection. It utilizes ROS 2 and Gazebo (Ignition) to simulate a Livox Avia LiDAR sensor, an X3 UAV target, and a clutter-rich forest environment.

## Key Features

- **Realistic Sensor Simulation**: Simulates the Livox Avia conical LiDAR using the Robotec GPU Lidar (RGL) plugin to capture non-repetitive scan patterns
- **Automatic Ground Truth**: A custom node subscribes to the simulation's ground truth pose data and generates precise 3D bounding boxes for the target drone in real-time
- **Environmental Clutter**: Populates the world with various tree models to create realistic background noise
- **Visualization**: Pre-configured RViz environment to view the point cloud and ground truth markers simultaneously

## Prerequisites

- ROS 2 (Tested on Humble/Rolling)
- Gazebo (Fortress or newer recommended)
- RGL Gazebo Plugin: Required to simulate the Livox Avia patterns

## Installation

### Create a Workspace

```bash
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws/src
```

### Clone this Repository

```bash
git clone <repository_url> drone_detector_sim
```

### Install Dependencies

```bash
sudo apt install ros-<distro>-ros-gz-sim ros-<distro>-ros-gz-bridge
```

### Setup RGL Plugin

Download and build the RGL Gazebo Plugin. The launch file expects lidar patterns at `~/simulations/RGLGazeboPlugin-0.2.0-fortress/lidar_patterns`. Adjust `rgl_patterns_dir` in `launch/detect_sim.launch.py` if needed.

### Build the Package

```bash
cd ~/ros2_ws
colcon build --packages-select drone_detector_sim
source install/setup.bash
```

## Usage

Launch the simulation, ROS-Gazebo bridges, ground truth node, and RViz:

```bash
ros2 launch drone_detector_sim detect_sim.launch.py
```

### What to Expect

- Gazebo displays a drone (X3 UAV), a LiDAR station, and a forest of pine/oak trees
- RViz2 shows:
    - PointCloud2 data from the simulated Livox Avia (`/lidar/avia`)
    - Blue Bounding Box (`/drone_bbox`) generated by the ground truth node

## Nodes and Topics

### ground_truth_bbox_node

Acts as the bridge between simulation state and training data generation.

**Subscribes to**: `/world/drone_world/pose/info` (tf2_msgs/TFMessage)  
**Publishes**: `/drone_bbox` (visualization_msgs/Marker)

**Bounding Box Dimensions**:
- Size X: 0.47m
- Size Y: 0.98m
- Size Z: 0.15m

### ROS-GZ Bridge

Automatically bridges:
- **LiDAR**: `/lidar/avia` (sensor_msgs/PointCloud2)
- **Pose**: `/world/drone_world/pose/info` (tf2_msgs/TFMessage)

## Project Context

This package is part of a larger research project on UAV tracking using acoustic sensor arrays and conical LiDARs. The data generated here trains the PointPillars network to classify drones, which is then fused with Direction of Arrival (DoA) audio data via a particle filter to control a pan/tilt tracking system.